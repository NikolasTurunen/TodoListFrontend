<div class="todolist unselectable" ng-class="{'todolist-minimized': $ctrl.minimized, 'todolist-maximized': !$ctrl.minimized}">
    <div class="todolist-header">
        <div ng-if="!$ctrl.minimized">
            <div class="todolist-title-row">
                <div ng-if="!$ctrl.selectedProject" class="todolist-title-text">Projects</div>
                <div ng-if="$ctrl.selectedProject" class="todolist-title-text">Project: {{$ctrl.selectedProject.name}}</div>
            </div>
        </div>
    </div>

    <div class="todolist-content">
        <div ng-if="!$ctrl.minimized">
            <div ng-if="!$ctrl.selectedProject">
                <div ng-repeat="project in $ctrl.projects" class="w100">
                    <div ng-click="$ctrl.selectProject(project)" class="todolist-project">
                        <div class="todolist-project-name">{{project.name}}</div>
                    </div>
                    <div ng-click="$ctrl.renameProjectDialog = true; $ctrl.selectedProjectForRename = project;" class="todolist-project-control todolist-project-control-edit"></div>
                    <div class="todolist-project-control">
                        <div ng-if="$ctrl.projects[$index - 1]" ng-click="$ctrl.swapProjects(project.id, $ctrl.projects[$index - 1].id)" class="todolist-project-control-arrow-up"></div>
                    </div>
                    <div class="todolist-project-control">
                        <div ng-if="$ctrl.projects[$index + 1]" ng-click="$ctrl.swapProjects(project.id, $ctrl.projects[$index + 1].id)" class="todolist-project-control-arrow-down"></div>
                    </div>
                    <div ng-click="$ctrl.removeProjectDialog = true; $ctrl.selectedProjectForRemove = project;" class="todolist-project-control todolist-project-control-remove"></div>
                </div>
            </div>
            <div ng-if="$ctrl.selectedProject">
                <div ng-repeat="task in $ctrl.tasks">
                    <div class="todolist-task">{{task.taskString}}</div>
                    <div class="todolist-task-detail" ng-repeat="detail in task.details">
                        {{detail.taskString}}
                    </div>
                </div>

                <div ng-if="$ctrl.createTaskDialog" class="todolist-create-task-dialog">
                    <div>New task:</div> 
                    <div><input class="todolist-new-task-input-text" type="text" ng-model="$ctrl.newTaskText"></div>
                    <div ng-click="$ctrl.createTask($ctrl.selectedProject.id, $ctrl.newTaskText)" class="todolist-button todolist-dialog-button-action">Create</div><div ng-click="$ctrl.createTaskDialog = false; $ctrl.newTaskText = undefined;" class="todolist-button todolist-dialog-button-cancel">Cancel</div>
                </div>
            </div>

            <!-- Create project dialog -->
            <action-cancel-dialog 
                status="$ctrl.createProjectDialog" 
                title-text="Create project" 
                error="$ctrl.createProjectError" 
                text-input="$ctrl.newProjectName" 
                action="$ctrl.createProject($ctrl.newProjectName)" 
                action-text="Create"></action-cancel-dialog>

            <!-- Rename project dialog -->
            <action-cancel-dialog 
                status="$ctrl.renameProjectDialog" 
                title-text="Rename project" 
                error="$ctrl.renameProjectError" 
                text-input="$ctrl.newProjectName" 
                action="$ctrl.renameProject($ctrl.selectedProjectForRename.id, $ctrl.newProjectName)" 
                action-text="Rename"></action-cancel-dialog>

            <!-- Remove project dialog -->
            <action-cancel-dialog 
                status="$ctrl.removeProjectDialog" 
                title-text="Remove project" 
                error="$ctrl.removeProjectError" 
                text="Are you sure you want to remove the project?"
                action="$ctrl.removeProject($ctrl.selectedProjectForRemove.id)" 
                action-text="Remove"></action-cancel-dialog>
        </div>
    </div>

    <div class="todolist-footer">
        <div ng-click="$ctrl.minimized = !$ctrl.minimized" class="todolist-maximize-minimize-button" 
             ng-class="{'todolist-big-arrow-right': $ctrl.minimized
                 , 'todolist-maximize-minimize-button-left': $ctrl.minimized
                 , 'todolist-big-arrow-left': !$ctrl.minimized
                 , 'todolist-maximize-minimize-button-right': !$ctrl.minimized
             }"></div>

        <div ng-if="!$ctrl.minimized">
            <div ng-if="!$ctrl.selectedProject">
                <div ng-click="$ctrl.createProjectDialog = true" class="todolist-button todolist-footer-button">Create Project</div>
            </div>

            <div ng-if="$ctrl.selectedProject">
                <div ng-click="$ctrl.selectedProject = null" class="todolist-button todolist-footer-button">Back</div>
                <div ng-click="$ctrl.createTaskDialog = true" class="todolist-button todolist-footer-button">New Task</div>
            </div>
        </div>
    </div>
</div>